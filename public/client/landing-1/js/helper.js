NOW.Charts=class{constructor(t={}){this.options=t,google.charts.load("current",{packages:["corechart"]})}draw(t,e,a,i,s=""){let n=this;return new Promise((async(s,o)=>{google.setOnLoadCallback((function(){var o=e.label.length,r=n.fill(e,a,i);n.ticks=[];var l=18;r.length<=180&&(l=9),r.length<=30&&(l=2),r.length<=7&&(l=1);for(var d=l-1,c=0;c<r.length;c++)++d==l&&(r[c]&&n.ticks.push({v:r[c][0],f:moment(1e3*r[c][0]).format("MMM DD")}),d=0);n.data=new google.visualization.DataTable,n.data.addColumn("number","date"),n.data.addColumn({type:"string",role:"tooltip",p:{html:!0}});for(c=0;c<o;c++)n.data.addColumn("number",e.label[c]);n.data.addRows(r),n.graph=new google.visualization.AreaChart($(t)[0]),s()}))}))}redraw(){let t=this;if($("html").hasClass("theme-dark")||$("html").hasClass("theme-auto")&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)var e="#242526FF",a="#18191A70";else e="#FFFFFFFF",a="#F0F2F570";t.graph_options={pointSize:0,focusTarget:"category",tooltip:{isHtml:!0},backgroundColor:e,height:"300",legend:{position:"none"},chartArea:{left:"10%",width:"90%"},series:{0:{color:"#058DC7",lineWidth:3,areaOpacity:.1},1:{color:"#FF7700",lineWidth:3,areaOpacity:.1},2:{color:"#7DBF5F",lineWidth:3,areaOpacity:.1}},hAxis:{gridlines:{color:a},textStyle:{color:"#8C8C8C",fontName:"Calibri",fontSize:13}},vAxis:{minValue:0,gridlines:{color:a},textStyle:{color:"#8C8C8C",fontName:"Calibri",fontSize:12}}},t.graph_options.hAxis.ticks=t.ticks,t.graph.draw(t.data,t.graph_options)}fill(t,e,a){let i=this;a=moment(a).utc().endOf("day"),e=moment(e).utc().endOf("day");let s=[],n=0,o=t.data,r=t.label.length;for(var l=e;l<=a;l.add(1,"day")){var d=l.format("YYYY-MM-DD");s[n]=Array(r+2).fill(0),s[n][0]=l.unix(),s[n][1]=i.options.tooltip(t.label,s[n][0],o[d]?o[d]:Array(r).fill(0));for(var c=0;c<r;c++)o[d]&&o[d][c]&&(s[n][c+2]=o[d][c]);n++}return s}},NOW.Collection=class{constructor(t=null,e=null){if(null==t)throw"primary key not provided";this.primary_key=t,null!=e&&this.load(e)}async load(t){if(this.array=[],this.object={},"string"==typeof t){t=(await axios.get(t)).data}if(Array.isArray(t)){this.array=t;for(let[e,a]of Object.entries(t))this.object[a[this.primary_key]]=a}else{if("object"!=typeof t)throw"unknown data type "+typeof t;this.object=t;for(const[e,a]of Object.entries(t))this.array.push(a)}return this.array}getObject(){return this.object}getArray(){return this.array}getArraySorted(){return this.getArray().sort((function(t,e){return t.text<e.text?-1:t.text>e.text?1:0}))}getAll(t){let e=[];for(let a in t)e.push(this.object[t[a]]);return e}get(t,e=null){let a=this.object[t];return"object"==typeof a&&null!=e?a[e]:null==a?"":a}find(t,e){for(let a in this.array)if(this.array[a][t]==e)return this.array[a];return null}sort(t,e=!0){return this.getArray().sort(((a,i)=>e?a[t]<i[t]?-1:a[t]>i[t]?1:0:a[t]<i[t]?1:a[t]>i[t]?-1:0))}filter(t,e,a=!1){let i=[];for(let a in this.array)this.array[a][t]==e&&i.push(this.array[a]);return a&&(i=i.sort((function(t,e){return t.text<e.text?-1:t.text>e.text?1:0}))),i}select2(t){let e=[];for(let a of this.array)a.db_key==t&&e.push(Object.assign({},a,{name:a.text,text:a.category+" "+a.text}));return e.sort((function(t,e){return t.text<e.text?-1:t.text>e.text?1:0}))}group(t){let e=[];for(let a of this.array)Array.isArray(e[a[t]])||(e[a[t]]=[]),e[a[t]].push(a);return e}set(t,e){t in this.object||this.array.push(e),this.object[t]=e}assign(t,e){t in this.object?Object.assign(this.object[t],e):this.set(ket,e)}remove(t,e=null){e=null==e?this.primary_key:e;for(let a in this.array)if(this.array[a][e]==t){delete this.object[this.array[a][this.primary_key]],this.array.splice(a,1);break}}};class FavList{static list={};static init(){const t=this;this.$dropdownTrigger=$("#favoriteDropdownTrigger"),this.$dropdownContainer=$("#favoriteDropdownContainer"),this.$dropdownTrigger.on("click",t.onDropdownOpen.bind(this)),$("body").on("click",'[data-trigger^="FavList."]',(function(e){e.stopPropagation();const a=e.currentTarget;switch(a.dataset.trigger){case"FavList.listingEvent":t.listingEvent(a);break;case"FavList.menuEvent":t.menuEvent(a);break;case"FavList.pubEvent":t.pubEvent(a)}}))}static clear(){this.list={}}static insert(t){const e=this;e.load();for(let a of t)e.list[a.list_type]||(e.list[a.list_type]=[]),e.list[a.list_type].push(a.pub_id)}static get(t){return this.load(),this.list[t]||[]}static save(){this.list&&window.localStorage.setItem("favList",JSON.stringify(this.list))}static load(){const t=this;try{t.list=JSON.parse(window.localStorage.getItem("favList")||"{}")}catch(e){t.list={}}return t.list}static checked(t,e){const a=this;return a.list.length||a.load(),a.list[t]&&-1!=a.list[t].indexOf(e)}static async menuEvent(t){console.log("menuEvent");var e=t.closest(".dropdown-item");await NOW.Library.load(["ladda","axios"]),Ladda.create(t).start(),await this.sendEvent(t,"delete")&&(t.dataset.list_status=-1*t.dataset.list_status+1),Ladda.create(t).stop(),e.classList.add("hide"),setTimeout((function(){e.remove()}),300);for(let e of document.querySelectorAll(`.info-tag.info-favorite[data-pub_id='${t.dataset.pub_id}']`))e.dataset.list_status="0"}static async listingEvent(t){await NOW.Library.load(["ladda","axios"]),Ladda.create(t).start(),await this.sendEvent(t)&&(t.dataset.list_status=-1*t.dataset.list_status+1),Ladda.create(t).stop()}static async pubEvent(t){const e=this;let a=t.dataset.list_type;if("1"!=t.dataset.require_login||NOW.session.user_id>0){let i=t.querySelector(".list-total"),s=0;i&&(s=parseInt(i.innerHTML)),await NOW.Library.load(["ladda","axios"]),Ladda.create(t).start(),await e.sendEvent(t)&&(1==t.dataset.list_status?(t.dataset.list_status=0,i&&s>0&&(i.innerHTML=s-1),"like"==a&&document.getElementById("favDropdownIcon").classList.remove("font-weight-800")):(t.dataset.list_status=1,i&&(i.innerHTML=s+1),"like"==a&&document.getElementById("favDropdownIcon").classList.add("font-weight-800"))),Ladda.create(t).stop()}else window.Account.login()}static listingOnChange(t=document){const e=this;for(let a of t.querySelectorAll(".info-tag.info-favorite"))e.checked("favorite",a.dataset.pub_id)&&(a.dataset.list_status="1")}static async sendEvent(t,e){const a=this;try{let s=t.dataset.list_type,n=t.dataset.pub_id,o=e?"post"==e:1!=t.dataset.list_status;if(NOW.session.user_id==n)return!1;if(a.load(),o&&"favorite"==t.dataset.list_type&&a.list.favorite){if(!(NOW.session.user_id>0)&&a.list.favorite.length>=10)return Alert.error(null,"<div class=\"px-10\">Llegaste al límite de <label class='font-weight-800'>10 favoritos</label>! registrate para agregar más.</div>\n                            <hr class=\"mt-10\">\n                            <button type=\"button\" class='btn text-primary btn-xl w-full mb--20' data-trigger='Auth.register'>Registrarse</button>\n                        "),!1;if(NOW.session.user_id>0&&"user"==NOW.session.user_type&&a.list.favorite.length>=20)return Alert.error(null,"Llegaste al limite de 20 favoritos"),!1}let r=axios({method:o?"post":"delete",url:`/api/favlist/${s}/${n}`,data:{pub_id:n,list_type:s}});if("favorite"!=s||1!=o||a.list[s]&&0!=a.list[s].length){await r}else{let[t]=await Promise.all([r,NOW.Phrases.load(["FAVORITES_TUTORIAL_TITLE","FAVORITES_TUTORIAL_SUBTITLE"])])}a.list[s]||(a.list[s]=[]);var i=a.list[s].indexOf(n);return o?-1==i&&a.list[s].push(n):i>-1&&a.list[s].splice(i,1),"favorite"==s&&1==o&&1==a.list[s].length&&Alert.success(null,`\n                    <div class="text-center">\n                        <h3 class="mt-10">${NOW.Phrases.get("FAVORITES_TUTORIAL_TITLE")}</h3>\n                        <div>${NOW.Phrases.get("FAVORITES_TUTORIAL_SUBTITLE")}</div>\n                        <video disableRemotePlayback loop muted playsinline autoplay class="mt-10 w-full" src="${NOW.settings.url_static}/images/favorite-tutorial-1.mp4"></video>\n                    </div>\n                `),a.save(),!0}catch(t){console.log(t),Alert.confirm({title:"Oops",msg:t.response.data.message||t,type:"OK"})}return!1}static async onDropdownOpen(t){if(t.target.ariaExpanded)if(this.$dropdownContainer.html('<div class="text-center pb-20"><i class="fas fa-circle-notch fa-spin fa-2x" style="animation-duration: 1s; opacity: 0.5"></i></div>'),await NOW.Library.load(["axios"]),NOW.session.user_id){var e=await fetch("/api/public/favorites/");e=await e.text(),this.$dropdownContainer.html(e)}else if(FavList.get("favorite").length){e=await fetch(`/api/public/favorites/${FavList.get("favorite")}`);e=await e.text(),this.$dropdownContainer.html(e)}else this.$dropdownContainer.html("")}}NOW.Form=class{constructor(t,e,a={}){this.formData=new FormData(t),this.event=e,this.options=$.extend({ladda:!0},a),this.form=t;let i={};function s(t){return t.replace(/[\u00A0\u2000-\u200B\u202F\u205F\u3000]/g," ")}for(var n of this.formData.entries()){const t=n[0],e=n[1];t.endsWith("[]")?(i[t]||(i[t]=[]),i[t].push(e)):i[t]=s(e)}for(let t in i)if(this.formData.delete(t),Array.isArray(i[t])){i[t].map((t=>s(t))).forEach((e=>this.formData.append(t,e)))}else this.formData.append(t,i[t])}set(t,e){this.formData.set(t,e)}get(t){return this.formData.get(t)}getAll(){let t={};for(var e of this.formData.entries())t[e[0]]=e[1];return t}convertDate(t,e,a){void 0!==this.get(t)&&this.set(t,moment(this.get(t),e).format(a))}serialize(){return new URLSearchParams(this.formData).toString()}lock(){return"vibrate"in navigator&&navigator.vibrate(1),1==$(this.form).data("submitting")||($(this.form).data("submitting",!0),this.options.ladda&&(void 0!==this.event?Ladda.create(this.event.originalEvent.submitter).start():Ladda.create($(this.form).find('[type="submit"]')[0]).start()),!1)}unlock(){$(this.form).data("submitting",!1),this.options.ladda&&(void 0!==this.event?Ladda.create(this.event.originalEvent.submitter).stop():Ladda.create($(this.form).find('[type="submit"]')[0]).stop())}clear(){this.form.reset()}},$.fn.removeClassPrefix=function(t){var e,a=new RegExp("(^|\\s)"+t+"\\S+","g");return this.each((function(){(e=this.getAttribute("class")).length&&this.setAttribute("class",e.replace(a,""))}))},NOW.LayoutCache={},NOW.Layout=class{constructor(t,e={}){if(void 0!==t){console.time(`compile-${t}`);var a=Twig.twig({data:document.getElementById(t).innerHTML});this.content=$(a.render(e)),NOW.Page.loadPlugins(this.content),console.timeEnd(`compile-${t}`)}return this}html(t,e={}){if(void 0!==t){var a=Twig.twig({data:t});this.content=$(a.render(e)),NOW.Page.loadPlugins(this.content)}return this.content.html()}fetch(){return this.content}bind(){return this.content}find(t){return this.content.find(t)}render(t="#page",e="write",a){a=void 0===a||null==a?$(document):a,"write"==e?a.find(t).html(this.content):"prepend"==e?a.find(t).prepend(this.content):"append"==e?a.find(t).append(this.content):"replace"==e?a.find(t).replaceWith(this.content):"after"==e&&a.find(t).after(this.content)}};class Slide{$container=null;$slide=null;constructor(){const t=this;this.$container=$('<div class="slide-container"></div>'),this.$slide=$('<div class="slide" ></div>'),this.$container.append(this.$slide),this.$slide.on("click","[data-dismiss='slide']",(function(){t.pop()}))}updateHeight(){console.log("update height"),this.$container.css("height",this.$container.find(".slide-page").last().innerHeight())}observe(){new MutationObserver((()=>{console.log("MutationObserver"),this.$container.is(":visible")&&this.updateHeight()})).observe(this.$container.get(0),{childList:!0,subtree:!0})}count(){return this.$slide.find(".slide-page").length}current(){this.$slide.css("--currentSlide")}loadFromTemplate(t,e={},a=!0){if(!document.getElementById(t))throw`template '${t}' does not exists in document`;var i=Twig.twig({data:document.getElementById(t).innerHTML});let s=$(`<div class="slide-page">${i.render(e)}</div>`);return a&&window.Plugins.load(s),this.push(s),s}async loadFromServer(t,e={},a={},i=!0){let[s]=await Promise.all([await fetch(`/api/fetch/modal/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),NOW.Library.load("twigjs")]);var n=await s.text(),o=Twig.twig({data:n});let r=$(`<div class="slide-page">${o.render(e)}</div>`);return i&&window.Plugins.load(r),this.push(r),r}async create(t,e={}){var a=Twig.twig({data:`<div class="slide-page">\n\t\t\t\t${1==e.loader?'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="border-radius: 50%; display: block; margin: 20px auto 100px auto;" width="75px" height="75px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="modal-loader">\n\t\t\t\t\t\t<circle cx="50" cy="50" r="28" stroke-width="7" stroke="var(--primary-color)" stroke-dasharray="43.982297150257104 43.982297150257104" fill="none" stroke-linecap="round">\n\t\t\t\t\t\t<animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" keyTimes="0;1" values="0 50 50;360 50 50"></animateTransform>\n\t\t\t\t\t\t</circle>\n\t\t\t\t\t</svg>':""}\n\t\t\t\t${t}</div>`});let i=$(a.render(e));return this.push(i),await window.Plugins.load(i),i}async setContent(t,e){var a=Twig.twig({data:t});let i=$(a.render(e));return this.$slide.find(".slide-page").last().html(i),await window.Plugins.load(i),i}replace(t,e){e=null==e?this.current():e,this.$slide.children().eq(e-1).html(t)}push(t,e=!0){"string"==typeof t&&(t=$(t)),t.find(".slide-page")||t.wrapAll('<div class="slide-page"></div>'),this.$slide.append(t),this.reloadCounter(),e&&this.setLastSlide()}async pop(t=1){const e=this;this.$slide.css("--currentSlide",this.count()-t),this.$container.css("height",this.$container.find(".slide-page").last().prev().innerHeight()),setTimeout((()=>{e.$slide.css("--slideTransition",0),e.$slide.children(`:nth-last-of-type(-n+${t})`).remove(),e.reloadCounter(),setTimeout((()=>{e.$slide.css("--slideTransition",1)}),10)}),300)}reloadCounter(){this.$slide.css("--slideCount",this.count())}setSlide(t){this.$slide.css("--currentSlide",t)}setLastSlide(){this.$slide.css("--currentSlide",this.count())}getPage(t){return null==t?this.$slide.find(".slide-page").last():this.$slide.find(".slide-page").get(t)}}class Modal{instance=null;options={};$modal=null;slide=null;constructor(t={}){this.instance="modal-"+(new Date).getTime(),this.options=$.extend({stack:!0},"smartphone"==NOW.Utils.getDevice()?{mode:"modal-fullpage",animation:"slideInUp"}:{mode:"",animation:"fade"},t.inline?{backdrop:!1,animation:""}:{},t)}instance(){return this.instance}async loadFromHTML(t,e={},a=!0){console.log(this.removeScriptTags(t));var i=Twig.twig({data:this.removeScriptTags(t)});let s=$(i.render(e));return this.$modal=s,a&&await window.Plugins.load(this.$modal),s}async loadFromTemplate(t,e={},a=!0){if(!document.getElementById(t))throw`template '${t}' does not exists in document`;var i=Twig.twig({data:document.getElementById(t).innerHTML});let s=$(i.render(e));return this.$modal=s,a&&await window.Plugins.load(this.$modal),s}async loadFromServer(t,e={},a={},i=!0){let[s]=await Promise.all([await fetch(`/api/fetch/modal/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),NOW.Library.load("twigjs")]);var n=await s.text(),o=Twig.twig({data:n});let r=$(o.render(e));return this.$modal=r,i&&await window.Plugins.load(this.$modal),r}async create(t,e={}){var a=Twig.twig({data:`\t<div class="modal fade" role="dialog" >\n\t\t\t\t\t\t<div class="modal-dialog ${this.options.class||""} ${e.class||""}" role="document">\n\t\t\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t\t\t<h5 class="modal-title">${e.title||""}</h5>\n\t\t\t\t\t\t\t\t\t<button type="button" class="close btn btn-default btn-circle" data-dismiss="modal" aria-label="Close"><i class="fal fa-times"></i></button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t\t${1==e.loader?'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="border-radius: 50%; display: block; margin: 20px auto 40px auto;" width="75px" height="75px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="modal-loader">\n\t\t\t\t\t\t\t\t\t\t<circle cx="50" cy="50" r="28" stroke-width="7" stroke="var(--primary-color)" stroke-dasharray="43.982297150257104 43.982297150257104" fill="none" stroke-linecap="round">\n\t\t\t\t\t\t\t\t\t\t<animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" keyTimes="0;1" values="0 50 50;360 50 50"></animateTransform>\n\t\t\t\t\t\t\t\t\t\t</circle>\n\t\t\t\t\t\t\t\t\t</svg>':""}\n\t\t\t\t\t\t\t\t${t||""}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`});return this.$modal=$(a.render(e)),await window.Plugins.load(this.$modal),this.$modal}createSteps(t){console.log(this.$modal);const e=this.$modal.find(".modal-title");e.replaceWith($(`<div class="d-flex align-items-center modal-steps">\n\t\t\t\t${'<i class="fal fa-circle ml-5 modal-step"></i>'.repeat(t)}\n\t\t\t\t<h5 class="modal-title">${e.html()||""}</h5>\n\t\t\t</div>`)),this.setStep(1)}setStep(t){this.$modal.find(".modal-step").removeClass("fa").addClass("fal"),this.$modal.find(`.modal-step:nth-child(-n+${t})`).removeClass("fal").addClass("fa")}setTitle(t){this.$modal.find(".modal-title").html(t)}async render(){const t=this,e=this.$modal;e.attr("id",t.instance),t.options.inline?(e.addClass("modal-inline"),t.options.inline.append(e)):(e.addClass(t.options.mode).addClass(t.options.animation).one("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",(function(){$(this).addClass("animation-off")})),$("body").addClass(t.options.mode),ModalManager.add(this,t.options.stack)),await t.show(),this.$modal.find("[data-dismiss='modal']").on("click",(async function(e){e.preventDefault(),e.stopPropagation(),await t.hide()}))}show(){const t=this;var e=$.Deferred();return this.$modal.on("hidden.bs.modal",(async function(e){e.currentTarget.remove(),t.options.callback&&t.options.callback.onClose&&t.options.callback.onClose(),t.options.inline||ModalManager.remove(t)})).on("shown.bs.modal",(function(a){$(this).off("shown.bs.modal"),t.options.inline?$("body").removeClass("modal-open"):$("body").addClass("modal-open"),e.resolve(t)})).modal($.extend({},{show:!0},t.options)),e}hide(){this.$modal.modal("hide"),"vibrate"in navigator&&navigator.vibrate(1)}async attachSlide(t){this.slide=t;const e=this.$modal.find(".modal-body");e.contents().appendTo(t.$container),e.append(t.$container),this.slide.observe()}getSlide(){return this.slide}removeScriptTags(t){const e=t.trim().match(/^<script[\s\S]*?>([\s\S]*?)<\/script>/);return e?e[1]:t}}var ModalManager={stack:[],$wrapper:$("#modal-wrapper"),add(t,e=!1){e?this.$wrapper.find(".modal").addClass("modal-off"):this.hideCurrent(),this.$wrapper.append(t.$modal),this.stack.push(t)},remove(t){const e=this.stack.indexOf(t);-1!==e&&this.stack.splice(e,1),0==this.stack.length?$("body").removeClassRegex(/^modal-/):($("body").addClass("modal-open"),0==this.$wrapper.find(".modal").not(".modal-off").length&&this.$wrapper.find(".modal-off").last().removeClass("modal-off"))},hideCurrent(){const t=this.current();t&&t.hide()},current:function(){if(0!=this.stack.length)return this.stack[this.stack.length-1]}},Alert={modal:async function(t,e={}){var a=$.Deferred();e=$.extend({},{stack:!0,mode:"",backdrop:"static",autoclose:0},e);const i=new Modal(e);let s=await i.loadFromTemplate("modal-confirm",t);if(i.render(),s.on("hidden.bs.modal",(function(t){$(this).off("hidden.bs.modal"),a.reject()})),s.find("#modal-confirm-btn, [data-resolve='modal']").on("click",(function(t){a.resolve($(this).attr("data-value")),i.hide()})),e.autoclose>0){let t=s.find("span.modal-close.animated-progress");t[0].animate([{width:"0%"},{width:t.attr("data-progress")+"%"}],{duration:e.autoclose}),sleep(e.autoclose).then((function(){a.resolve(),i.hide()}))}if(e.delay>0){s.find("#modal-confirm-btn, [data-resolve='modal']").attr("disabled",!0);let t=s.find("span.modal-close.animated-progress");t[0].animate([{width:"0%"},{width:t.attr("data-progress")+"%"}],{duration:e.delay}),sleep(e.delay).then((function(){s.find("#modal-confirm-btn, [data-resolve='modal']").attr("disabled",!1)}))}return a},confirm:async function(t,e){return Alert.modal($.extend({type:"confirm"},t),e)},delete:async function(t,e){return Alert.modal($.extend({type:"delete"},t),e)},success:async function(t,e="",a){return Alert.modal({title:'<i class="fa fa-check-circle fa-2x"></i>',msg:t?NOW.Phrases.get(t):e,type:"OK"},a)},error:async function(t,e="",a){return Alert.modal({title:'<i class="fa fa-circle-exclamation fa-2x"></i>',msg:t?NOW.Phrases.get(t):e,type:"OK"},a)},bug:async function(t,e="",a){return Alert.modal({title:'<i class="fa fa-bug fa-2x"></i>',msg:t?NOW.Phrases.get(t):e,type:"OK"},a)}};NOW.Phrases=class{static cache={};static async load(t){const e=this;try{let a=[];for(let i of"string"==typeof t?[t]:t)i in e.cache||a.push(i);if(a.length){let t=await fetch(`/api/fetch/phrases/${a}`);t=await t.json(),Object.assign(e.cache,t)}}catch(t){console.log(t)}}static get(t,e=""){var a=this.cache[t];return a||console.log("phrase not loaded "+t),a&&a!=t?a:e}},window.Plugins={load:async t=>{const e=window.Plugins;await Promise.all([e.horizontalScroll(t),e.loadSelect2(t),e.loadSelectPicker(t),e.loadSelectRadio(t),e.loadSelectCheckbox(t),e.loadSwitchery(t),e.loadintlTelInput(t),e.loadSegment(t),e.loadClipboard(t),e.loadMoment(t)])},horizontalScroll:async t=>{let e=t.find(".horizontal-scroll");if(e.length)if(NOW.Utils.isMobile()){await NOW.Library.load(["throttle"]);for(let t of e){var a=$(t);a.css("--elements-count",a.children().length||0),a.on("scroll",$.throttle(250,(function(){$(this).scrollLeft()>25?$(this).closest(".relative").children(".horizontal-scroll-more").addClass("opacity-hide"):$(this).closest(".relative").children(".horizontal-scroll-more").removeClass("opacity-hide")})))}}else{await NOW.Library.load(["throttle","scrollbooster"]);for(let t of e){let e=$(t).parent();e.css("overflow","hidden");let a=new ScrollBooster({viewport:e[0],content:t,direction:"horizontal",emulateScroll:!1,scrollMode:"native",onClick:(t,e)=>{if(1==t.isMoving)return e.preventDefault(),void e.stopPropagation()}}),i=$(t).closest(".tab-pane");if(i.length){let t=i.attr("data-col");i.closest(".nav-tabs").find(`.nav-link[data-col="${t}"]`).on("click",(async function(){await new Promise((t=>setTimeout(t,50))),a.updateMetrics()}))}$(t).parent().on("scroll",$.throttle(250,(function(){$(this).scrollLeft()>25?$(this).closest(".relative").children(".horizontal-scroll-more").addClass("opacity-hide"):$(this).closest(".relative").children(".horizontal-scroll-more").removeClass("opacity-hide")})))}}},loadintlTelInput:async t=>{let e=t.find('input[data-plugin="intlTelInput"]');if(e.length){await NOW.Library.load(["intlTelInput"]);for(let t of e)intlTelInput(t,{preferredCountries:["ar","br","cl","co","ec","es","mx","pe","py","uy","vz"],nationalMode:1==t.dataset.national_mode,autoPlaceholder:"aggressive",initialCountry:NOW.vars.user_country,utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.5/js/utils.min.js"})}},loadSwitchery:async t=>{let e=t.find('input[data-plugin="switchery"]');if(e.length){await NOW.Library.load(["switchery"]);for(let t of e){var a=$(t).data("size");new Switchery(t,{size:a||"default"})}}},loadSelectCheckbox:async t=>{let e=t.find('select[data-plugin="select-checkbox"]');if(e.length)for(let t of e)new SelectCheckbox(t)},loadSelectRadio:async t=>{let e=t.find('select[data-plugin="select-radio"]');if(e.length)for(let t of e)new SelectRadio(t)},loadSegment:async t=>{let e=t.find('select[data-plugin="segment"]');if(e.length){await NOW.Library.load(["segment"]);for(let a of e){$(a).Segment({tpl:t})}}},loadClipboard:async t=>{let e=t.find('button[data-plugin="clipboard"]');if(e.length)for(let t of e)t.addEventListener("click",(function(e){e.preventDefault();const a=document.createElement("textarea");a.value=t.dataset.clipboardtext,a.setAttribute("readonly",""),a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)}))},loadSelect2:async t=>{let e=t.find('select[data-plugin="select2"],button[data-plugin="select2"]');if(e.length){await NOW.Library.load(["select2"]);for(let t of e){let e=$(t);var a=e.select2({placeholder:e.attr("placeholder")||e.attr("data-none-selected-text")||"Seleccionar",escapeMarkup:function(t){return t},allowClear:!0,closeOnSelect:!e.attr("multiple"),sorter:function(t){return t.sort((function(t,e){return t.text<e.text?-1:t.text>e.text?1:0}))}});let i=e.attr("value");i&&(e.attr("multiple")?a.val(NOW.Utils.split(i)):a.val(i),a.trigger("change.select2"))}}},loadSelectPicker:async t=>{var e=t.find('select[data-plugin="selectpicker"]');if(e.length){await NOW.Library.load(["selectpicker"]);for(let t of e){let e=$(t);e.selectpicker({style:e.attr("data-style")||""}),e.parent().addClass(e.attr("data-container-style")||"");let a=e.attr("value");a&&(e.attr("multiple")?e.selectpicker("val",NOW.Utils.split(a)):e.selectpicker("val",a),e.selectpicker("refresh"))}}},loadMoment:async t=>{const e=t.find('[data-plugin="moment"]');if(e.length)for(const t of e){const e=$(t),a=e.html(),i=e.attr("data-format");"fromNow"==i?e.html(moment(a+"Z").local().fromNow()):e.html(moment(a+"Z").local().format(i))}}};class Post{static initialized=!1;static init(){const t=this;t.initialized||(t.initialized=!0,$("body").on("click",'[data-trigger^="Post."]',(function(e){const a=e.currentTarget;switch(void 0===a.dataset.allowPropagation&&e.stopPropagation(),a.dataset.trigger){case"Post.validate":var i=a.dataset.post_id,s=a.dataset.post_status;t.validate(i,s);break;case"Post.delete":i=a.dataset.post_id;t.delete(i);break;case"Post.sticky":t.sticky(a);break;case"Post.send":var n=a.dataset.pub_id;i=a.dataset.post_id;t.send(n,i)}})))}static async send(t,e){return new Promise((async(a,i)=>{try{const s=new Modal({callback:{onClose:i}});let[n]=await Promise.all([s.loadFromServer("post",{},{quote_id:e}),NOW.Library.load(["ladda","axios"])]);s.render(),n.find("form").on("submit",(async function(i){i.preventDefault();let n=new NOW.Form(i.target);if(n.lock())return!1;try{let i=await axios.post(`${NOW.settings.url_api}/post/${t}`,n.serialize());if(i.data.message&&await Alert.confirm({title:"",msg:i.data.message,type:"OK"}),s.hide(),window.Page instanceof NOW.Publication&&window.Page.pub_id==t)if(e){document.querySelector(`div[data-post_id="${e}"] .comment-replies`).insertAdjacentHTML("afterend",i.data.html),document.querySelector(`div[data-post_id="${e}"]`).classList.remove("comment-pending"),document.querySelector(`div[data-post_id="${e}"]`).classList.add("comment-published")}else{document.getElementById("posts-container").insertAdjacentHTML("afterbegin",i.data.html)}a()}catch(t){Alert.confirm({title:"Oops",msg:t?.response?.data?.message||t,type:"OK"})}n.unlock()}))}catch(t){Alert.confirm({title:"Oops",msg:t.response.data.message||t,type:"OK"}),i()}}))}static async delete(t){return new Promise((async(e,a)=>{try{const a=await axios.delete(`${NOW.settings.url_api}/post/${t}`),{status:i,message:s,data:n}=a.data;window.Page instanceof NOW.Publication&&window.Page.pub_id==n.pub_id&&document.querySelector(`div[data-post_id="${t}"]`).remove(),e()}catch(t){Alert.confirm({title:"Oops",msg:t?.response?.data?.message||t,type:"OK"}),a()}}))}static async sticky(t){const e=t.dataset.post_id,a=t.dataset.post_sticky;axios.put(`${NOW.settings.url_api}/post/${e}`,{post_sticky:a}),"1"==a?document.querySelector(`div[data-post_id="${e}"]`).classList.add("comment-sticky"):document.querySelector(`div[data-post_id="${e}"]`).classList.remove("comment-sticky")}static validate(t,e){return new Promise((async(a,i)=>{try{const i=await axios.put(`${NOW.settings.url_api}/post/${t}`,{post_status:e}),{status:s,message:n,data:o}=i.data;if(window.Page instanceof NOW.Publication&&window.Page.pub_id==o.pub_id){const e=document.querySelector(`div[data-post_id="${t}"]`);e?.classList.remove("comment-pending"),"published"==o.post_status?e?.classList.add("comment-published"):"negative"==o.post_status&&e?.classList.add("comment-negate")}a()}catch(t){Alert.confirm({title:"Oops",msg:t?.response?.data?.message||t,type:"OK"}),i()}}))}}function throttle(t,e){var a=!1;return function(){a||(e.apply(this,arguments),a=!0,setTimeout((function(){a=!1}),t))}}function sleep(t){return new Promise((e=>setTimeout(e,t)))}!function(t){t.fn.story=function(a){var i=[],s=null,n=null,o=Twig.twig({data:document.getElementById("story-modal.tpl").innerHTML});let r=async(a=0)=>{for(e of(await NOW.Library.load(["moment"]),t("body").addClass("no-overflow "),i=[],s.children())){let a=t(e).data();i.push(a)}(n=t(o.render({storyList:i,session:NOW.session}))).on("animationend",(function(e){let a=t(e.target).closest(".story");m(a)})).on("click",".story-prev",(function(){f(t(this).closest(".story"))})).on("click",".story-next",(function(){m(t(this).closest(".story"))})).on("click",".story-unmute",(function(e){let a=t(e.target).closest(".story");u(a)})).on("click",'[role="close"]',(function(t){d()})).on("click",'[role="deleteStory"]',(function(t){l(t.target.closest(".story"))})),t("body").append(n),h(a)},l=async t=>{try{t.dataset.pub_id;let e=current_item[0].dataset.id;await fetch(`/api/profile/story/${e}`,{method:"DELETE"}),d(),location.reload()}catch(t){}},d=()=>{t("body").removeClass("no-overflow "),n.remove(),null,current_item=null},c=e=>{let a=e.data("show"),i=t(e.find(".story-content").children().get(a));if(i.is("video")){i[0].pause(),i[0].currentTime=0;let t=i.find("source"),e=t.attr("src");t.removeAttr("src"),i[0].load(),t.attr("data-src",e)}},u=e=>{let a=e.data("show"),i=t(e.find(".story-content").children().get(a));if(i.is("video")){let t=i[0];t.muted=!1,t.volume=1,t.removeAttribute("muted"),e.find(".story-unmute").hide()}},h=(e=0,a=!1)=>{console.log(e);let i=t(n.find(".story").get(e));i,i.find(".story-content").children().removeClass("show"),n.find(".story-scroll").css("transform","translate3d(-"+100*e+"vw,0px,0px)");let s=a?i.find(".story-content").children().length-1:0;p(i,s)},p=(e,a=0)=>{e.data("show",a),n.find(".story-progress").find("div").removeClass("active");let i=t(e.find(".story-progress").find("div").get(a));e.find(".story-content").children().removeClass("show");let s=t(e.find(".story-content").children().get(a));if(current_item=s,e.find(".ago").html(moment(s.data("ago")+"Z").local().fromNow()),i.prevAll().addClass("done"),i.removeClass("done"),i.nextAll().removeClass("done"),s.is("video")){let t=s[0],a=s.find("source");a.attr("data-src")&&(a.attr("src",a.attr("data-src")),s[0].load()),i.addClass("paused"),t.hasAttribute("controls")&&t.removeAttribute("controls"),NOW.Utils.isMobile()?t.hasAttribute("muted")?e.find(".story-unmute").show():e.find(".story-unmute").hide():(t.muted=!1,t.volume=1,t.removeAttribute("muted"),e.find(".story-unmute").hide());var o=function(){t.duration&&(i.find("b").css("animation-duration",`${t.duration}s`),i.addClass("active"))};o(),t.addEventListener("loadedmetadata",o),t.onwaiting=function(){i.addClass("paused")},t.onplaying=function(){i.removeClass("paused")},t.currentTime=0,t.play().catch((t=>{"NotAllowedError"===t.name?console.error("La reproducción automática fue bloqueada. Necesita interacción del usuario."):console.error("Error al intentar reproducir el video:",t)}))}else e.find(".story-unmute").hide(),i.find("b").css("animation-duration","5s"),i.addClass("paused"),i.addClass("active"),setTimeout((function(){i.removeClass("paused")}),300);s.addClass("show")},m=t=>{c(t);let e=t.index(),a=t.data("show");a<y(t)-1?p(t,a+1):(w(t),e<g()-1?h(e+1):d())},f=t=>{let e=t.index(),a=t.data("show");return a>0?(c(t),void p(t,a-1)):e>0?(c(t),void h(e-1,!0)):void 0},g=t=>n.find(".story").length,y=e=>t(e).find(".story-content").children().length,v=()=>{var t="stories_seen";return window.localStorage[t]?JSON.parse(window.localStorage[t]):{}},w=e=>{let a=e.data("story_id"),i=e.data("media_id");t(".stories-list").find(`[data-story_id="${a}"] .img`).addClass("seen");let s=v();s[a]=i;window.localStorage.stories_seen=JSON.stringify(s)};v();return this.each((function(){t(this).find(".story"),t(this).on("click",".listing-story:not(.listing-story-trigger)",(function(e){s=t(this).closest(".section-listing"),e.preventDefault(),e.stopPropagation(),"0"==t(this).parent().attr("data-story_queue")&&r(t(this).closest(".story").index())}))})),this}}(jQuery),window.Terms={cache:{},loaded:[],load:async function(t){try{let a=window.Terms;if(a.loaded.includes(t))return;var e=await fetch(`/api/fetch/terms/${t}`);e=await e.json(),Object.assign(a.cache,e),a.loaded.push(t)}catch(t){console.log(t)}},get:function(t){var e=window.Terms.cache[t];return e||(console.log(`term_id (${t}) doesn't exists`),"")}},String.prototype.toSlug=function(){var t=this.valueOf();t=(t=t.replace(/^\s+|\s+$/g,"")).toLowerCase();for(var e="åàáãäâèéëêìíïîòóöôùúüûñç·/_,:;",a=0;a<30;a++)t=t.replace(new RegExp(e.charAt(a),"g"),"aaaaaaeeeeiiiioooouuuunc------".charAt(a));return t=t.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},String.prototype.phoneNumber=function(){return this.valueOf().replace(/[-+\s]/g,"")},$.fn.removeClassRegex=function(t){return $(this).removeClass((function(e,a){return a.split(/\s+/).filter((function(e){return t.test(e)})).join(" ")}))},Twig.extendFilter("unescape",((t,e)=>$("<textarea />").html(t).text())),Twig.extendFunction("setting",(t=>NOW.settings[t]||"")),$.fn.delayKeyup=function(t,e=200){return $(this).keyup((function(a){var i=a.currentTarget;i.delayTimer&&clearTimeout(i.delayTimer),i.delayTimer=setTimeout((function(){t(a)}),e)})),$(this)},NOW.Utils={cssVar:function(t,e){return"-"!=t[0]&&(t="--"+t),e&&document.documentElement.style.setProperty(t,e),getComputedStyle(document.documentElement).getPropertyValue(t)},copyToClipboard:function(t){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)},split:function(t){return"string"==typeof t&&t.length>0?t.split(","):[]},includes:function(t,e){return console.log(e),NOW.Utils.split(t).includes(String(e))},getObjectByValue:function(t,e,a){return t.filter((function(t){return t[e]===a}))},getObjectByKey:function(t,e){let a={};for(let i=0,s=Object.keys(t).length;i<s;i++)a[t[i][e]]=t[i];return a},getArrayByKey:function(t,e){let a={};for(let i=0,s=Object.keys(t).length;i<s;i++)Array.isArray(a[t[i][e]])||(a[t[i][e]]=[]),a[t[i][e]].push(t[i]);return a},isMobile:function(t="any"){const e=function(){return navigator.userAgent.match(/Android/i)},a=function(){return navigator.userAgent.match(/BlackBerry/i)},i=function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},s=function(){return navigator.userAgent.match(/Opera Mini/i)},n=function(){return navigator.userAgent.match(/IEMobile/i)};switch(t){case"Android":return e();case"BlackBerry":return a();case"iOS":return i();case"Opera":return s();case"Windows":return n();case"any":return e()||a()||i()||s()||n()}},openLink:function(t,e="_blank"){const a=document.createElement("a");a.target=e,a.rel="noreferrer noopener",a.href=t,a.click()},getDevice:function(t){return window.innerWidth<=640?"smartphone":navigator.userAgent.match(/Tablet|iPad|Android/i)&&window.innerWidth<=1280?"tablet":"desktop"},getAndroidVer:function(){var t=navigator.userAgent.toLowerCase().match(/android\s([0-9\.]*)/i);return t?t[1]:void 0},recursiveBase64StrToArrayBuffer:function(t){let e="=?BINARY?B?",a="?=";if("object"==typeof t)for(let i in t)if("string"==typeof t[i]){let s=t[i];if(s.substring(0,11)===e&&s.substring(s.length-2)===a){s=s.substring(11,s.length-2);let e=window.atob(s),a=e.length,n=new Uint8Array(a);for(let t=0;t<a;t++)n[t]=e.charCodeAt(t);t[i]=n.buffer}}else NOW.Utils.recursiveBase64StrToArrayBuffer(t[i])},arrayBufferToBase64:function(t){let e="",a=new Uint8Array(t),i=a.byteLength;for(let t=0;t<i;t++)e+=String.fromCharCode(a[t]);return window.btoa(e)}};class XP{static initialized=!1;static init(){const t=this;t.initialized||(t.initialized=!0,$("body").on("click",'[data-trigger^="XP."]',(function(e){e.stopPropagation();const a=e.currentTarget;switch(a.dataset.trigger){case"XP.delete":t.delete(a);break;case"XP.validate":t.validate(a);break;case"XP.send":t.send(a)}})))}static async validate(t){const e=t.dataset.xp_id,a=t.dataset.xp_status;await axios.put(`${NOW.settings.url_api}/xp/${e}`,{xp_status:a});document.querySelector(`div[data-xp_id="${e}"]`).remove()}static async delete(t){const e=t.dataset.xp_id;await axios.delete(`${NOW.settings.url_api}/xp/${e}`);document.querySelector(`div[data-xp_id="${e}"]`).remove()}static async send(t){t.dataset.xp_id;const e=t.dataset.pub_id,a=new Modal;let[i]=await Promise.all([a.loadFromServer("postXP"),NOW.Library.load(["ladda","axios"])]);a.render();for(let t of i.find('input[type="range"]'))t.style.setProperty("--value",t.value),t.style.setProperty("--min",""==t.min?"0":t.min),t.style.setProperty("--max",""==t.max?"100":t.max),t.addEventListener("input",(()=>{t.dataset.switch&&0==t.value&&(t.value=1,$(t.dataset.switch).trigger("click")),t.style.setProperty("--value",t.value),t.nextElementSibling.innerHTML=t.value}));for(let t of i.find(".xp-switch"))t.addEventListener("change",(()=>{let e=$(t).prev();t.checked?(e.css("opacity",1),e.find('input[type="range"]').attr("disabled",!1),e.find(".xp-value").show()):(e.css("opacity",.5),e.find('input[type="range"]').attr("disabled",!0),e.find(".xp-value").hide())}));i.find("form").on("submit",(async function(t){t.preventDefault();let i=new NOW.Form(t.target);if(i.lock())return!1;try{let t=await axios.post(`${NOW.settings.url_api}/xp/${e}`,i.serialize());document.getElementById("xps-container").insertAdjacentHTML("afterbegin",t.data.html),t.data.message&&await Alert.confirm({title:"",msg:t.data.message,type:"OK"}),a.hide()}catch(t){Alert.confirm({title:"Oops",msg:t.response.data.message||t,type:"OK"})}i.unlock()}))}}